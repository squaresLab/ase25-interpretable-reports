

--- falcon180b-62960.c	2023-10-03 12:00:00.000000000 +0000
+++ falcon180b-62960-fixed.c	2023-10-03 12:05:00.000000000 +0000
@@ -12,6 +12,7 @@
 
 void *handle_client(void *arg) {
     int client_socket = *(int *) arg;
+    int client_index = -1;
     char buffer[BUFFER_SIZE];
 
     while (1) {
@@ -21,6 +22,7 @@
             break;
         }
 
+        for (int i = 0; i < num_clients; i++) if (client_sockets[i] == client_socket) client_index = i;
         printf("Client %d: %s\n", client_socket, buffer);
 
         for (int i = 0; i < num_clients; i++) {
@@ -29,6 +31,8 @@
         }
     }
 
+    if (client_index != -1) client_sockets[client_index] = -1;
+    num_clients--;
     close(client_socket);
     return NULL;
 }
@@ -50,8 +54,12 @@
         client_sockets[num_clients] = client_socket;
         num_clients++;
 
+        for (int i = 0; i < num_clients; i++) {
+            if (client_sockets[i] == -1) {
+                client_sockets[i] = client_socket;
+                break;
+            }
+        }
         pthread_t thread_id;
         pthread_create(&thread_id, NULL, handle_client, (void *) &client_socket);
     }
 }

