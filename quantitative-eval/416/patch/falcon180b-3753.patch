

--- falcon180b-3753.c	2023-10-11 12:34:56.000000000 -0700
+++ falcon180b-3753_fixed.c	2023-10-11 12:45:00.000000000 -0700
@@ -19,7 +19,7 @@
 void *scanner(void *arg) {
     int interface_index = *(int *)arg;
     char buffer[PACKET_SIZE];
-    while (1) {
+    ssize_t bytes_received;
+    while ((bytes_received = recvfrom(sock, buffer, sizeof(buffer)-1, 0, NULL, NULL)) > 0) {
         if (bytes_received < 0) {
             printf("Error receiving packet on interface %s\n", interfaces[interface_index]);
             break;
@@ -25,8 +25,10 @@
             printf("Error receiving packet on interface %s\n", interfaces[interface_index]);
             break;
         }
-        printf("Received packet on interface %s: %s\n", interfaces[interface_index], buffer);
+        buffer[bytes_received] = '\0'; // Ensure null-termination
+        printf("Received packet on interface %s: %s\n", interfaces[interface_index], buffer);
     }
+    return NULL;
 }

 void start_scanner(int interface_index) {
@@ -38,7 +40,7 @@
     char buffer[PACKET_SIZE];
+    ssize_t bytes_received;
-    while (1) {
+    while ((bytes_received = recvfrom(sock, buffer, sizeof(buffer)-1, 0, NULL, NULL)) > 0) {
         if (bytes_received < 0) {
             printf("Error receiving packet\n");
             break;
@@ -44,6 +46,7 @@
             printf("Error receiving packet\n");
             break;
         }
+        buffer[bytes_received] = '\0'; // Ensure null-termination
         printf("Received packet: %s\n", buffer);
         for (int i = 0; i < num_interfaces; i++) {
             start_scanner(i);

