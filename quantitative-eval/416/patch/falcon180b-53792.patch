 

--- a/falcon180b-53792
+++ b/falcon180b-53792
@@ -45,10 +45,12 @@ void *handle_client(void *arg) {
 
     close(client_socket);
 
-    for (int i = 0; i < num_clients; i++) {
-        if (clients[i] == client_socket) {
-            clients[i] = -1;
-        }
+    pthread_mutex_lock(&clients_mutex);
+    for (int i = 0; i < MAX_CLIENTS; i++) {
+        if (clients[i] == client_socket) {
+            clients[i] = 0;
+            break;
         }
+    pthread_mutex_unlock(&clients_mutex);
 
-    num_clients--;
+    __sync_fetch_and_sub(&num_clients, 1);
 }
 
 
