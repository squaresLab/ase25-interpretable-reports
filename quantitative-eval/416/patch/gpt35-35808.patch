 

--- old_gpt35-35808.c
+++ new_gpt35-35808.c
@@ -51,10 +51,14 @@
     int client_fd = accept(server_fd, (struct sockaddr *)&client_address, (socklen_t *)&address_len);
 
     if(client_fd < 0) {
       perror("accept() failed");
       exit(EXIT_FAILURE);
     }
 
     printf("Connection accepted from %s:%d\n", inet_ntoa(client_address.sin_addr), ntohs(client_address.sin_port));
 
     pthread_mutex_lock(&mutex);
+    int thread_arg = num_clients; // Capture num_clients value within mutex lock
     client_socket[num_clients] = client_fd;
     printf("Client %d connected.\n", num_clients+1);
     num_clients++;
 
-    pthread_t thread;
-    int arg = num_clients-1;
-    pthread_create(&thread, NULL, client_communication, &arg);
+    pthread_t thread;
+    pthread_create(&thread, NULL, client_communication, &thread_arg);
     pthread_mutex_unlock(&mutex);
   }

