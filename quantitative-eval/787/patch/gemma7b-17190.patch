 

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_BUFFER_SIZE 1024

typedef struct CSVReader {
    FILE* file;
    char** buffer;
    int bufferSize;
    int lineNumber;
    int columnNumber;
} CSVReader;

CSVReader* csvReader_init(char* filename) {
    CSVReader* reader = (CSVReader*)malloc(sizeof(CSVReader));
    reader->file = fopen(filename, "r");
    reader->buffer = NULL;
    reader->bufferSize = 0;
    reader->lineNumber = 0;
    reader->columnNumber = 0;
    return reader;
}

void csvReader_free(CSVReader* reader) {
    fclose(reader->file);
    for (int i = 0; i < reader->bufferSize; i++) {
        free(reader->buffer[i]);
    }
    free(reader->buffer);
    free(reader);
}

int csvReader_readNextLine(CSVReader* reader) {
    char* line = NULL;

    reader->lineNumber++;

    // Allocate memory for the line
    line = (char*)malloc(MAX_BUFFER_SIZE);

    // Read the line from the file
    if (fgets(line, MAX_BUFFER_SIZE, reader->file) == NULL) {
        free(line);
        return -1;
    }

    // Store the line in the buffer
    reader->buffer = (char**)realloc(reader->buffer, (reader->bufferSize + 1) * sizeof(char*));
    reader->buffer[reader->bufferSize++] = line;
    return 0;
}

int csvReader_getLineNumber(CSVReader* reader) {
    return reader->lineNumber;
}

int csvReader_getColumnNumber(CSVReader* reader) {
    return reader->columnNumber;
}

char* csvReader_getLine(CSVReader* reader) {
    if (reader->lineNumber - 1 < reader->bufferSize) {
        return reader->buffer[reader->lineNumber - 1];
    }
    return NULL;
}

int main() {
    CSVReader* reader = csvReader_init("example.csv");

    // Read the next line from the CSV file
    if (csvReader_readNextLine(reader) == 0) {
        // Get the line number and column number
        int lineNumber = csvReader_getLineNumber(reader);
        int columnNumber = csvReader_getColumnNumber(reader);

        // Get the line
        char* line = csvReader_getLine(reader);

        // Print the line
        if (line != NULL) {
            printf("Line %d, Column %d: %s\n", lineNumber, columnNumber, line);
        }
    }

    // Free the CSV reader
    csvReader_free(reader);

    return 0;
}

