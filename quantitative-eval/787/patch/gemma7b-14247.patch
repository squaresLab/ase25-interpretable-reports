 

--- a/gemma7b-14247
+++ b/gemma7b-14247
@@ -19,12 +19,12 @@ void csv_reader_read(CSVReader *reader)
 {
     int line_size = 0;
     char *line = NULL;
+    size_t len = 0;
 
-    while (getline(reader->fp, line, MAX_BUFFER_SIZE) > 0)
+    while (getline(&line, &len, reader->fp) != -1)
     {
-        reader->buffer = realloc(reader->buffer, (reader->size + 1) * sizeof(char *));
-        reader->buffer[reader->size++] = line;
+        reader->buffer = realloc(reader->buffer, (reader->size + 1) * sizeof(char *));
+        reader->buffer[reader->size++] = strdup(line);
     }
+    free(line);
 }
 
 void csv_reader_close(CSVReader *reader)

    